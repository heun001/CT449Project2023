{"ast":null,"code":"import \"../../public/assets/css/chat.css\";\nimport axios from \"axios\";\nimport swal from \"sweetalert2\";\nimport store from \"../vuex/store\";\nexport default {\n  data() {\n    return {\n      message: \"\",\n      page: 0,\n      email: this.$route.params.email,\n      receiver: null,\n      attachment: null,\n      base64Str: \"\",\n      downloadFileName: \"\",\n      btnLoadMoreClass: \"fa fa-repeat\",\n      hasMoreMessages: true\n    };\n  },\n  computed: {\n    messages() {\n      return store.getters.getMessages;\n    }\n  },\n  methods: {\n    loadMore: function () {\n      this.btnLoadMoreClass = \"fa fa-spinner fa-spin\";\n      this.page++;\n      this.getData();\n      this.btnLoadMoreClass = \"fa fa-repeat\", this.hasMoreMessages = response.data.messages.length == 0 ? false : true;\n    },\n    downloadAttachment: async function () {\n      const anchor = event.target;\n      const id = anchor.getAttribute(\"data-id\");\n      const originalHtml = anchor.innerHTML;\n      anchor.innerHTML = \"Loading...\";\n      const formData = new FormData();\n      formData.append(\"messageId\", id);\n      const response = await axios.post(this.$apiURL + \"/chat/attachment\", formData, {\n        headers: this.$headers\n      });\n      if (response.data.status == \"success\") {\n        this.base64Str = response.data.base64Str;\n        this.downloadFileName = response.data.fileName;\n        const btnDownloadAttachment = this.$refs[\"btnDownloadAttachment\"];\n        setTimeout(function () {\n          btnDownloadAttachment.click();\n          anchor.innerHTML = originalHtml;\n        }, 500);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    fileSelected: function () {\n      const files = event.target.files;\n      if (files.length > 0) {\n        this.attachment = files[0];\n      }\n    },\n    selectFile: function () {\n      document.getElementById(\"attachment\").click();\n    },\n    getMessageTime: function (time) {\n      const dateObj = new Date(time);\n      let timeStr = dateObj.getFullYear() + \"-\" + (dateObj.getMonth() + 1) + \"-\" + dateObj.getDate() + \" \" + dateObj.getHours() + \":\" + dateObj.getMinutes() + \":\" + dateObj.getSeconds();\n      return timeStr;\n    },\n    getData: async function () {\n      if (this.email == null) {\n        return;\n      }\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"page\", this.page);\n      if (this.attachment != null) {\n        formData.append(\"attachment\", this.attachment);\n      }\n      const response = await axios.post(this.$apiURL + \"/chat/fetch\", formData, {\n        headers: this.$headers\n      });\n      this.btnLoadMoreClass = \"fa fa-repeat\";\n\n      // console.log(response)\n\n      if (response.data.status == \"success\") {\n        for (let a = 0; a < response.data.messages.length; a++) {\n          store.commit(\"prependMessage\", response.data.messages[a]);\n        }\n        this.receiver = response.data.receiver;\n        this.user = response.data.user;\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    },\n    sendMessage: async function () {\n      const formData = new FormData();\n      formData.append(\"email\", this.email);\n      formData.append(\"message\", this.message);\n      const response = await axios.post(this.$apiURL + \"/chat/send\", formData, {\n        headers: this.$headers\n      });\n      // console.log(response)\n\n      if (response.data.status == \"success\") {\n        this.message = \"\";\n        this.attachment = null;\n        document.getElementById(\"attachment\").value = null;\n        store.commit(\"appendMessage\", response.data.messageObject);\n      } else {\n        swal.fire(\"Error\", response.data.message, \"error\");\n      }\n    }\n  },\n  mounted() {\n    this.getData();\n  }\n};","map":{"version":3,"names":["axios","swal","store","data","message","page","email","$route","params","receiver","attachment","base64Str","downloadFileName","btnLoadMoreClass","hasMoreMessages","computed","messages","getters","getMessages","methods","loadMore","getData","response","length","downloadAttachment","anchor","event","target","id","getAttribute","originalHtml","innerHTML","formData","FormData","append","post","$apiURL","headers","$headers","status","fileName","btnDownloadAttachment","$refs","setTimeout","click","fire","fileSelected","files","selectFile","document","getElementById","getMessageTime","time","dateObj","Date","timeStr","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","a","commit","user","sendMessage","value","messageObject","mounted"],"sources":["D:\\2023\\2023_PTUDW\\chat-station-mevn-free\\chat-station-mevn-free\\web\\src\\components\\ChatComponent.vue"],"sourcesContent":["<template>\r\n    <div class=\"container\">\r\n        <div class=\"row clearfix\">\r\n            <div class=\"col-lg-12\">\r\n                <div class=\"card chat-app\">\r\n                    <div class=\"chat\">\r\n                        <div class=\"chat-header clearfix\">\r\n                            <div class=\"row\">\r\n                                <div class=\"col-lg-6\">\r\n                                    <a href=\"javascript:void(0);\" data-toggle=\"modal\" data-target=\"#view_info\">\r\n                                        <img src=\"https://bootdey.com/img/Content/avatar/avatar2.png\" alt=\"avatar\">\r\n                                    </a>\r\n\r\n                                    <div class=\"chat-about\">\r\n                                        <h6 class=\"m-b-0 text-white\" v-if=\"receiver != null\" v-text=\"receiver.name\"\r\n                                            style=\"margin-bottom: 0px; position: relative; top: 10px;\"></h6>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div class=\"col-lg-6 hidden-sm text-right text-white\">\r\n                                    <span v-if=\"attachment != null\"\r\n                                        style=\"margin-right: 10px; position: relative; top: 7px;\"\r\n                                        v-text=\"attachment.name\"></span>\r\n                                    <a href=\"javascript:void(0);\" class=\"btn btn-outline-secondary pull-right text-white\"\r\n                                        v-on:click=\"selectFile\"><i class=\"fa fa-paperclip\"></i></a>\r\n                                    <input type=\"file\" id=\"attachment\" style=\"display: none;\" v-on:change=\"fileSelected\" />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div class=\"chat-history\">\r\n                            <ul class=\"m-b-0\">\r\n                                <li style=\"text-align: center;\">\r\n                                    <i v-bind:class=\"btnLoadMoreClass + ' btnLoadMore'\" v-on:click=\"loadMore\"\r\n                                        v-if=\"hasMoreMessages\"></i>\r\n                                </li>\r\n                                <li v-for=\"msg in messages\" class=\"clearfix\" v-bind:key=\"msg._id\">\r\n                                    <div\r\n                                        v-bind:class=\"'message-data ' + (user != null && user.email == msg.sender.email ? 'text-right' : '')\">\r\n                                        <span class=\"message-data-time text-white\"\r\n                                            v-text=\"getMessageTime(msg.createdAt)\"></span>\r\n                                        <img src=\"https://bootdey.com/img/Content/avatar/avatar7.png\" alt=\"avatar\"\r\n                                            style=\"width: 50px;\" />\r\n                                    </div>\r\n\r\n                                    <div\r\n                                        v-bind:class=\"'message ' + (user != null && user.email == msg.sender.email ? 'my-message float-right' : 'other-message')\">\r\n                                        <p v-text=\"msg.message\"\r\n                                            v-bind:class=\"(user != null && user.email == msg.sender.email ? 'text-right' : '')\"\r\n                                            style=\"margin-bottom: 0px;\"></p>\r\n\r\n                                        <template v-if=\"msg.attachment != null\">\r\n                                            <a href=\"javascript:void(0)\" v-bind:data-id=\"msg._id\"\r\n                                                v-on:click.prevent=\"downloadAttachment\" v-text=\"msg.attachment.displayName\"\r\n                                                class=\"text-info\" target=\"_blank\"></a>\r\n                                        </template>\r\n                                    </div>\r\n                                </li>\r\n                            </ul>\r\n                        </div>\r\n\r\n                        <div class=\"chat-message clearfix\">\r\n                            <div class=\"input-group mb-0\">\r\n                                <div class=\"input-group mb-3\">\r\n                                    <input type=\"text\" class=\"form-control\" placeholder=\"Enter text here...\"\r\n                                        v-model=\"message\" />\r\n                                    <button class=\"btn btn-primary\" v-on:click=\"sendMessage\" type=\"button\">Send</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <a v-bind:href=\"base64Str\" ref=\"btnDownloadAttachment\" v-bind:download=\"downloadFileName\"></a>\r\n</template>\r\n \r\n<script>\r\n\r\nimport \"../../public/assets/css/chat.css\"\r\nimport axios from \"axios\"\r\nimport swal from \"sweetalert2\"\r\nimport store from \"../vuex/store\"\r\nexport default {\r\n    data() {\r\n        return {\r\n            message: \"\",\r\n            page: 0,\r\n            email: this.$route.params.email,\r\n\r\n            receiver: null,\r\n\r\n            attachment: null,\r\n            base64Str: \"\",\r\n            downloadFileName: \"\",\r\n\r\n            btnLoadMoreClass: \"fa fa-repeat\",\r\n            hasMoreMessages: true,\r\n        }\r\n    },\r\n    computed: {\r\n        messages() {\r\n            return store.getters.getMessages\r\n        }\r\n    },\r\n\r\n    methods: {\r\n\r\n        loadMore: function () {\r\n            this.btnLoadMoreClass = \"fa fa-spinner fa-spin\"\r\n            this.page++\r\n            this.getData(\r\n\r\n            )\r\n            this.btnLoadMoreClass = \"fa fa-repeat\",\r\n                this.hasMoreMessages = (response.data.messages.length == 0) ? false : true\r\n        },\r\n\r\n        downloadAttachment: async function () {\r\n            const anchor = event.target\r\n            const id = anchor.getAttribute(\"data-id\")\r\n            const originalHtml = anchor.innerHTML\r\n            anchor.innerHTML = \"Loading...\"\r\n\r\n            const formData = new FormData()\r\n            formData.append(\"messageId\", id)\r\n\r\n            const response = await axios.post(\r\n                this.$apiURL + \"/chat/attachment\",\r\n                formData,\r\n                {\r\n                    headers: this.$headers\r\n                }\r\n            )\r\n\r\n            if (response.data.status == \"success\") {\r\n                this.base64Str = response.data.base64Str\r\n                this.downloadFileName = response.data.fileName\r\n\r\n                const btnDownloadAttachment = this.$refs[\"btnDownloadAttachment\"]\r\n                setTimeout(function () {\r\n                    btnDownloadAttachment.click()\r\n                    anchor.innerHTML = originalHtml\r\n                }, 500)\r\n            } else {\r\n                swal.fire(\"Error\", response.data.message, \"error\")\r\n            }\r\n        },\r\n\r\n        fileSelected: function () {\r\n            const files = event.target.files\r\n            if (files.length > 0) {\r\n                this.attachment = files[0]\r\n            }\r\n        },\r\n\r\n        selectFile: function () {\r\n            document.getElementById(\"attachment\").click()\r\n        },\r\n\r\n        getMessageTime: function (time) {\r\n            const dateObj = new Date(time)\r\n            let timeStr = dateObj.getFullYear() + \"-\" + (dateObj.getMonth() + 1) + \"-\" + dateObj.getDate() + \" \" + dateObj.getHours() + \":\" + dateObj.getMinutes() + \":\" + dateObj.getSeconds()\r\n            return timeStr\r\n        },\r\n\r\n        getData: async function () {\r\n            if (this.email == null) {\r\n                return\r\n            }\r\n\r\n            const formData = new FormData()\r\n            formData.append(\"email\", this.email)\r\n            formData.append(\"page\", this.page)\r\n            if (this.attachment != null) {\r\n                formData.append(\"attachment\", this.attachment)\r\n            }\r\n\r\n\r\n            const response = await axios.post(\r\n                this.$apiURL + \"/chat/fetch\",\r\n                formData,\r\n                {\r\n                    headers: this.$headers\r\n                }\r\n            )\r\n            this.btnLoadMoreClass = \"fa fa-repeat\"\r\n\r\n            // console.log(response)\r\n\r\n            if (response.data.status == \"success\") {\r\n                for (let a = 0; a < response.data.messages.length; a++) {\r\n                    store.commit(\"prependMessage\", response.data.messages[a])\r\n                }\r\n                \r\n                this.receiver = response.data.receiver\r\n                this.user = response.data.user\r\n\r\n            } else {\r\n                swal.fire(\"Error\", response.data.message, \"error\")\r\n            }\r\n        },\r\n\r\n        sendMessage: async function () {\r\n\r\n            const formData = new FormData()\r\n            formData.append(\"email\", this.email)\r\n            formData.append(\"message\", this.message)\r\n\r\n            const response = await axios.post(\r\n                this.$apiURL + \"/chat/send\",\r\n                formData,\r\n                {\r\n                    headers: this.$headers\r\n                }\r\n            )\r\n            // console.log(response)\r\n\r\n            if (response.data.status == \"success\") {\r\n                this.message = \"\"\r\n                this.attachment = null\r\n                document.getElementById(\"attachment\").value = null\r\n\r\n                store.commit(\"appendMessage\", response.data.messageObject)\r\n            } else {\r\n                swal.fire(\"Error\", response.data.message, \"error\")\r\n            }\r\n        },\r\n    },\r\n    mounted() {\r\n        this.getData()\r\n    }\r\n}\r\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}